<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HanRead</title>

  <style>
    body {
      background: #0f0f0f;
      color: #e5e5e5;
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif;
      margin: 20px;
    }
    h1 { color: #f0f0f0; }
    .subtitle { color: #b5b5b5; margin-bottom: 20px; }
    button {
      background: #2a2a2a;
      color: #fff;
      border: 1px solid #3a3a3a;
      border-radius: 6px;
      padding: 12px 18px;
    }
    textarea {
      background: #1a1a1a;
      color: #e5e5e5;
      border: 1px solid #2f2f2f;
      border-radius: 6px;
      padding: 10px;
      width: 100%;
      min-height: 90px;
    }
    .section { margin-top: 24px; }
    .note { color: #9a9a9a; font-size: 0.85em; }
  </style>

  <!-- 拼音 -->
  <script src="https://unpkg.com/pinyin-pro"></script>

  <!-- OCR -->
  <script src="https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"></script>
</head>

<body>
  <h1>HanRead</h1>
  <div class="subtitle">中国語を読むためのWebツール</div>

  <input type="file" id="imageInput" accept="image/*" />
  <br /><br />
  <button onclick="processImage()">写真をアップロード</button>

  <div class="note">※ 縦書き未対応（横向き撮影推奨）</div>

  <div class="section">
    <label>原文：</label>
    <textarea id="originalText" readonly>—</textarea>
  </div>

  <div class="section">
    <label>普通話（拼音）：</label>
    <textarea id="mandarinText" readonly>—</textarea>
  </div>

  <script>
    async function processImage() {
      const input = document.getElementById("imageInput");
      const original = document.getElementById("originalText");
      const mandarin = document.getElementById("mandarinText");

      if (!input.files.length) {
        alert("画像を選んでください");
        return;
      }

      original.value = "読み取り中…";
      mandarin.value = "—";

      const result = await Tesseract.recognize(
        input.files[0],
        "chi_sim+chi_tra"
      );

      const text = result.data.text.trim();
      original.value = text || "（文字が検出されませんでした）";

      if (text) {
        mandarin.value = pinyinPro.pinyin(text, { toneType: "symbol" });
      }
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Chinese Reading Helper</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: system-ui, -apple-system, "Noto Sans CJK JP", sans-serif;
      padding: 24px;
      line-height: 1.6;
      background: #fafafa;
      color: #222;
    }

    h1 {
      font-size: 1.4rem;
      margin-bottom: 0.5rem;
    }

    .desc {
      color: #555;
      margin-bottom: 1.5rem;
    }

    button {
      padding: 10px 18px;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      background: #222;
      color: #fff;
      cursor: pointer;
    }

    input[type="file"] {
      display: none;
    }

    .note {
      font-size: 0.8rem;
      color: #666;
      margin-top: 1rem;
    }

    hr {
      margin: 2rem 0;
      border: none;
      border-top: 1px solid #ddd;
    }

    .block {
      margin-bottom: 1.25rem;
    }

    .block strong {
      display: block;
      margin-bottom: 0.25rem;
    }

    .result {
      background: #fff;
      padding: 12px;
      border-radius: 6px;
      box-shadow: 0 0 0 1px #ddd;
      white-space: pre-wrap;
      min-height: 2.5em;
    }
  </style>
</head>
<body>

  <!-- タイトル -->
  <h1>Chinese Reading Helper</h1>

  <div class="desc">
    普通話・広東語の<br>
    発音を見るためのツール
  </div>

  <!-- 画像アップロード -->
  <label for="imageInput">
    <button>写真をアップロード</button>
  </label>
  <input type="file" id="imageInput" accept="image/*">

  <!-- 注意書き -->
  <div class="note">
    ※ 縦書き未対応（横向き撮影推奨）
  </div>

  <!-- 結果表示 -->
  <hr>

  <div id="resultArea">

    <div class="block">
      <strong>原文：</strong>
      <div id="originalText" class="result">—</div>
    </div>

    <div class="block">
      <strong>普通話（拼音）：</strong>
      <div id="mandarinText" class="result">—</div>
    </div>

    <div class="block">
      <strong>広東語（Jyutping）：</strong>
      <div id="cantoneseText" class="result">—</div>
    </div>

  </div>

  <!-- tesseract.js -->
  <script src="https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"></script>

  <!-- メイン処理 -->
  <script>
    const imageInput = document.getElementById('imageInput');
    const originalText = document.getElementById('originalText');
    const mandarinText = document.getElementById('mandarinText');
    const cantoneseText = document.getElementById('cantoneseText');

    async function runOCR(file) {
      const { data } = await Tesseract.recognize(
        file,
        'chi_tra', // 繁体字。必要なら 'chi_sim' に変更
        {
          logger: m => {
            // console.log(m); // 進捗を見たいときは有効化
          }
        }
      );
      return data.text;
    }

    imageInput.addEventListener('change', async (e) => {
      const file = e.target.files[0];
      if (!file) return;

      originalText.textContent = '読み取り中…';
      mandarinText.textContent = '—';
      cantoneseText.textContent = '—';

      try {
        const text = await runOCR(file);
        originalText.textContent =
          text.trim() || '（文字が検出されませんでした）';
      } catch (err) {
        originalText.textContent = '読み取りに失敗しました';
        console.error(err);
      }
    });
  </script>

</body>
</html>